<mat-toolbar color="primary">
	<mat-icon>work</mat-icon>
	<span>Create Sensor Job</span>
</mat-toolbar>

<mat-dialog-content class="layout-fill layout-padding job-request-create-dialog-content">

	<!-- Use local templates to avoid duplication between horizontal and vertical -->
	<!-- https://stackoverflow.com/questions/48032538/switch-between-vertical-and-horizontal-stepper-material -->
	<!-- The designs are so diff to fit in mobile, ended up duplicating big steps to make it simpler -->

	<ng-template #step3>

		<h3>The <i><span *ngIf="job?.operation === 'SOFTWARE_UPDATE'">{{'sensor.job.operation.' + job.operation | translate}}</span>
			<span *ngIf="job?.operation === 'SOFTWARE_UPDATE'">{{job.packageName}}</span>
			<span *ngIf="job?.operation === 'DATA_EXTRACT'">{{'sensor.job.operation.DATA_EXTRACT.' + job.operationQualifier | translate}}</span></i> job is ready to be sent to the selected sensors.</h3>

		<!--<mat-form-field>
			<input matInput [(ngModel)]="description" type="text" placeholder="Job Description" minlength="1" maxlength="250" style="width: 100%;">
		</mat-form-field>-->
	</ng-template>

	<mat-horizontal-stepper labelPosition="bottom" #stepperH fxShow.lt-md="false">
		<mat-step label="Job">
			<mat-radio-group [(ngModel)]="job" required="required" class="layout-column">
				<table>
					<tbody>
					<tr *ngFor="let job of jobs">
						<td style="width: 1%;">
							<mat-radio-button [value]="job"></mat-radio-button>
						</td>
						<td style="width: 30%;">
							<div *ngIf="job?.operation === 'SOFTWARE_UPDATE'">{{'sensor.job.operation.' + job.operation | translate}}</div>
							<div *ngIf="job?.operation === 'SOFTWARE_UPDATE'">{{job.packageName}}</div>
							<div *ngIf="job?.operation === 'DATA_EXTRACT'">{{'sensor.job.operation.DATA_EXTRACT.' + job.operationQualifier | translate}}</div>
						</td>
						<td>
							<p>
								<span style="font-weight: bold;">{{job.description}}</span>
								&nbsp;{{job.detail}}
							</p>
						</td>
					</tr>
					</tbody>
				</table>
			</mat-radio-group>
		</mat-step>
		<mat-step label="Sensors">
			<table>
				<thead>
				<tr>
					<td></td>
					<td>Sensor Name</td>
					<td></td>
					<td>Status</td>
					<td>Location</td>
				</tr>
				</thead>
				<tbody>
				<tr *ngFor="let sensorSelection of sensorSelections">
					<td style="width: 1%; text-align: center;">
						<mat-checkbox [(ngModel)]="sensorSelection.selected" [checked]="sensorSelection.selected"></mat-checkbox>
					</td>
					<td style="width: 30%;">{{sensorSelection.item.name}}</td>
					<td style="width: 1%; text-align: center;">
						<mat-icon *ngIf="sensorSelection.item.GetConnected()" class="success-indicator">check_circle</mat-icon>
						<mat-icon *ngIf="!sensorSelection.item.GetConnected()" class="warn-indicator">close</mat-icon>
					</td>
					<td>{{'sensor.status.' + sensorSelection.item.GetState() | translate}}</td>
					<td>{{sensorSelection.item.attributes.location}}</td>
				</tr>
				</tbody>
			</table>
		</mat-step>
		<mat-step label="Launch">
			<ng-container *ngTemplateOutlet="step3"></ng-container>
		</mat-step>
	</mat-horizontal-stepper>

	<mat-vertical-stepper labelPosition="bottom" #stepperV fxShow.gt-sm="false">
		<mat-step label="Job">
			<mat-radio-group [(ngModel)]="job" required="required" class="layout-column">
				<table>
					<tbody>
					<tr *ngFor="let job of jobs">
						<td style="width: 1%;">
							<mat-radio-button [value]="job"></mat-radio-button>
						</td>
						<td>
							<div *ngIf="job.operation === 'SOFTWARE_UPDATE'">{{'sensor.job.operation.' + job.operation | translate}}</div>
							<div *ngIf="job.operation === 'SOFTWARE_UPDATE'">{{job.packageName}}</div>
							<div *ngIf="job.operation === 'COMMAND'">{{'sensor.job.operation.COMMAND.' + job.operationQualifier | translate}}</div>
						</td>
					</tr>
					</tbody>
				</table>
			</mat-radio-group>
		</mat-step>
		<mat-step label="Sensors">
			<table>
				<tbody>
				<tr *ngFor="let sensorSelection of sensorSelections">
					<td style="width: 1%; text-align: center;">
						<mat-checkbox [(ngModel)]="sensorSelection.selected" [checked]="sensorSelection.selected"></mat-checkbox>
					</td>
					<td>{{sensorSelection.item.name}}</td>
					<td style="width: 1%; text-align: center;">
						<mat-icon *ngIf="sensorSelection.item.GetConnected()" class="success-indicator">check_circle</mat-icon>
						<mat-icon *ngIf="!sensorSelection.item.GetConnected()" class="warn-indicator">close</mat-icon>
					</td>
				</tr>
				</tbody>
			</table>
		</mat-step>
		<mat-step label="Launch">
			<ng-container *ngTemplateOutlet="step3"></ng-container>
		</mat-step>
	</mat-vertical-stepper>

</mat-dialog-content>

<mat-dialog-actions align="end" fxShow.lt-md="false">
	<button mat-button mat-dialog-close>Cancel</button>
	<span class="flex"></span>
	<button mat-button (click)="stepperH.previous()" *ngIf="stepperH && stepperH.selectedIndex !== 0">Back</button>
	<button mat-raised-button (click)="stepperH.next()" *ngIf="stepperH && stepperH._steps && stepperH.selectedIndex !== stepperH._steps.length - 1">Next</button>
	<button mat-raised-button (click)="create()" *ngIf="stepperH && stepperH._steps && stepperH.selectedIndex === stepperH._steps.length - 1">Create Job</button>
</mat-dialog-actions>

<mat-dialog-actions align="end" fxShow.gt-sm="false">
	<button mat-button mat-dialog-close>Cancel</button>
	<span class="flex"></span>
	<button mat-button (click)="stepperV.previous()" *ngIf="stepperV && stepperV.selectedIndex !== 0">Back</button>
	<button mat-raised-button (click)="stepperV.next()" *ngIf="stepperV && stepperV._steps && stepperV.selectedIndex !== stepperV._steps.length - 1">Next</button>
	<button mat-raised-button (click)="create()" *ngIf="stepperV && stepperV._steps && stepperV.selectedIndex === stepperV._steps.length - 1">Create Job</button>
</mat-dialog-actions>